<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Red Bull Four 2 Score 試合速報</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:#041626;color:#fff;font-family:'Noto Sans JP',sans-serif}
.section{margin:1.5rem auto;max-width:900px;padding:0 1rem}
h1{font-size:1.4rem;font-weight:700}
.table thead th,.table td{white-space:nowrap;font-size:.85rem}
.table-responsive{overflow-x:auto}
/* ▼ スケジュール表（.tbl-schedule） */
.tbl-schedule col:nth-child(1){width:64px}   /* 時間 */
.tbl-schedule col:nth-child(2){width:72px}   /* コート */
.tbl-schedule col:nth-child(3),
.tbl-schedule col:nth-child(4){width:140px}  /* チーム名 */
/* ▼ 順位表（.tbl-stand） */
.tbl-stand col:nth-child(1){width:140px}     /* チーム列だけ固定 */
.nav-link{color:white;}
.canva-time-link{
  position: relative;
  width: 100%;
  height: 0;
  padding-top: 97.1701%%;
  padding-bottom: 0;
  box-shadow: 0 2px 8px 0 rgba(63, 69, 81, 0.16);
  margin-top: 1.6em;
  margin-bottom: 0.9em;
  overflow: hidden;
  border-radius: 8px;
  will-change: transform;
}
.canva-tournament-link{
  position: relative;
  width: 100%;
  height: 0;
  padding-top: 70.1701%%;
  padding-bottom: 0;
  box-shadow: 0 2px 8px 0 rgba(63, 69, 81, 0.16);
  margin-top: 1.6em;
  margin-bottom: 0.9em;
  overflow: hidden;
  border-radius: 8px;
  will-change: transform;
}
/* ── 順位：上位 2 チーム ── */
tr.cutoff td{
  border-bottom:4px solid #28a745 !important;   /* お好みで色・太さ変更可 */
}
/* ── スケジュール：試合終了 ── */
tr.finished         {opacity:.6}
tr.finished td      {text-decoration:line-through}
.tbl-schedule .team-red   {color:#ff4b4b;font-weight:700;}   /* 左側：Red */
.tbl-schedule .team-white {color:#ffffff;font-weight:700;}   /* 右側：White */
@media (max-width: 600px) {
  .canva-time-link{
    padding-top: 137.1701%;
  }
  .canva-tournament-link{
    padding-top: 71.1701%;
  }
}
</style>
</head>
<body class="text-center">

<!-- ★ RedBull ロゴ -->
<img src="https://www.sperio.jp/wp-content/uploads/2025/06/Red-Bull-Four-2-Score-Logo-NEW-scaled.png"
     class="mx-auto d-block" alt="Red Bull" style="height:160px">

<h1 class="mb-3">Red Bull Four 2 Score <br>試合速報</h1>

<!-- ★ NAV TABS -->
<ul class="nav nav-tabs justify-content-center mb-3" id="mainTabs" role="tablist">
  <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-timetable" type="button">タイムテーブル</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-A">グループA</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-B">グループB</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-C">グループC</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-D">グループD</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-final">決勝</button></li>
</ul>

<div class="tab-content" id="tabArea">
  <!-- ▼ タイムテーブル：Canva で作った表を iframe 埋込み -->
  <div class="tab-pane fade show active" id="tab-timetable">
    <div class="section" style="max-width:630px;">
      <div style="position: relative; width: 100%; height: 0; padding-top: 100.0000%;
       padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
       border-radius: 8px; will-change: transform;">
        <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
          src="https://www.canva.com/design/DAGqs6FtqA0/tYPiHoYe0dPImRQCx29VDw/view?embed" allow="fullscreen">
        </iframe>
      </div>
    </div>
  </div>

  <!-- ▼ ブロック別タブ（HTMLは空、JSで動的描画） -->
  <div class="tab-pane fade" id="tab-A"><div class="section" id="secA"></div></div>
  <div class="tab-pane fade" id="tab-B"><div class="section" id="secB"></div></div>
  <div class="tab-pane fade" id="tab-C"><div class="section" id="secC"></div></div>
  <div class="tab-pane fade" id="tab-D"><div class="section" id="secD"></div></div>

  <!-- ▼ 決勝タブ（13:00 以前はメッセージ） -->
  <div class="tab-pane fade" id="tab-final">
    <div class="section" id="secFinal" style="max-width: 800px;"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzoZ3n68zVJSJ8VZb8-dYZr7PfPsrpy0NQo6pUbA_pm1XxN-bLUMvFRHSgokofk-9UQTA/exec';
function loadJsonp(){
  const s   = document.createElement('script');
  s.src     = GAS_URL + '?callback=renderAll&_t=' + Date.now(); // キャッシュ防止
  document.head.appendChild(s);
}
loadJsonp();                      // 初回
// setInterval(loadJsonp, 20000); // ← 周期更新したいとき

// ---------- メイン描画 ----------
function renderAll(d){
  data = d;                     // 再利用用に保持
  drawBlock('A','#secA', data);
  drawBlock('B','#secB', data);
  drawBlock('C','#secC', data);
  drawBlock('D','#secD', data);
  drawFinal(data);
}

// ---------- ブロック別スケジュール＋順位 ----------
function drawBlock(block, selector, data){
  const schRows = data.schedule.slice(1).filter(r=>r[1]===block);
  const staRows = data.standings.slice(1)
                 .filter(r=>r[1]===block)
                 .sort((a,b)=>b[9]-a[9]||(b[6]-b[7])-(a[6]-a[7]));
  document.querySelector(selector).innerHTML = `
    <h2 class="h5 text-warning mb-2">スケジュール</h2>
    ${tableSchedule(schRows)}
    <h2 class="h5 text-warning mt-4 mb-2">順位</h2>
    ${tableStand(staRows, block)}
  `;
}

// ---------- 決勝タブ（日本時間 13:00 以降だけ表示） ----------
function drawFinal(data){
  // 現在時刻（JST）
  const nowJST = new Date(new Date().toLocaleString('en-US', {timeZone:'Asia/Tokyo'}));
  // ★ 公開開始日時を固定で指定（JST）
  const showTime = new Date('2025-07-05T13:00:00+09:00');

  const sec = document.getElementById('secFinal');
  if(nowJST >= showTime){
    sec.innerHTML = `<div style="position: relative; width: 100%; height: 0; padding-top: 70.7071%;
         padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
         border-radius: 8px; will-change: transform;">
        <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
          src="https://www.canva.com/design/DAGqrwpowko/YdmKppEiVPjY-aoIwMxo0w/view?embed" allow="fullscreen">
        </iframe>
      </div>`;
  }else{
    // sec.innerHTML = '<p class="pt-3">決勝トーナメント情報は日本時間 13:00 以降に公開されます。</p>';
    sec.innerHTML = `<div style="position: relative; width: 100%; height: 0; padding-top: 70.7071%;
         padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
         border-radius: 8px; will-change: transform;">
        <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
          src="https://www.canva.com/design/DAGqrwpowko/YdmKppEiVPjY-aoIwMxo0w/view?embed" allow="fullscreen">
        </iframe>
      </div>`;
  }
}

// ---------- テーブル生成関数 ----------
function tableSchedule(rows){
  const tr = rows.map(r=>{
    const klass = r[7]==='試合終了' ? 'finished' : '';
    return `<tr class="${klass}"><td>${r[0]}</td><td>${r[4]}</td><td class="team-red">${r[2]}</td><td class="team-white">${r[3]}</td></tr>`;
  }).join('');
  return `
    <div class="table-responsive"><table class="table table-dark table-striped mb-0 tbl-schedule">
      <colgroup><col><col><col><col></colgroup>
      <thead><tr><th>開始時刻</th><th>コート</th><th class="team-red">RED</th><th class="team-white">WHITE</th></tr></thead>
      <tbody>${tr}</tbody>
    </table></div>`;
}

function tableStand(rows){
  const tr = rows.map((r,i)=>{
    const klass = (i===1) ? 'cutoff' : '';
    return `<tr class="${klass}">
      ${[0,2,3,4,5,6,7,8,9].map(j=>`<td>${r[j]}</td>`).join('')}
    </tr>`;
  }).join('');
  return `
    <div class="table-responsive"><table class="table table-dark table-striped mb-0 tbl-stand">
      <colgroup><col><col span="8"></colgroup>
      <thead><tr><th>チーム</th><th>試合</th><th>勝</th><th>分</th><th>負</th><th>得点</th><th>失点</th><th>得失</th><th>勝点</th></tr></thead>
      <tbody>${tr}</tbody>
    </table></div>`;
}

function tableKO(rows){
  const tr = rows.map(r=>`<tr>${[0,1,2,3,4,5].map(i=>`<td>${r[i]??''}</td>`).join('')}</tr>`).join('');
  return `<div class="table-responsive"><table class="table table-dark table-striped mb-0">
    <thead><tr><th>ラウンド</th><th></th><th></th><th>得点</th><th>得点</th><th>勝者</th></tr></thead><tbody>${tr}</tbody></table></div>`;
}
</script>
</body></html>
